<div class="page-container">

  <div class="page-header">
    <%= link_to root_path, class: "back-btn" do %>
      â† Back
    <% end %>
    <h1 class="page-title">ğŸŒŒ Aurora Sighting</h1>
  </div>

  <div class="show-card" style="padding: 0; overflow: hidden;">
    <div id="aurora-map" style="height: 220px; width: 100%; border-radius: 20px;"></div>
  </div>

  <div class="show-card">
    <div class="show-row">
      <span class="show-label">â± Spotted</span>
      <span class="show-value green">
        <%= @minutes_ago == 0 ? 'Just now' : "#{@minutes_ago} min ago" %>
      </span>
    </div>
    <div class="show-row">
      <span class="show-label">ğŸ“ Coordinates</span>
      <span class="show-value">
        <%= @aurora.latitude.round(4) %>, <%= @aurora.longitude.round(4) %>
      </span>
    </div>
    <% if @distance_km %>
      <div class="show-row">
        <span class="show-label">ğŸ“ Distance</span>
        <span class="show-value"><%= @distance_km %> km from you</span>
      </div>
    <% end %>
  </div>

  <% if @aurora.description.present? %>
    <div class="show-card">
      <div class="show-label">ğŸ’¬ Description</div>
      <div class="show-description"><%= @aurora.description %></div>
    </div>
  <% end %>

  <% if @aurora.photo.attached? %>
    <div class="show-card" style="padding: 0; overflow: hidden;">
      <%= image_tag @aurora.photo, style: "width: 100%; border-radius: 20px; display: block;" %>
    </div>
  <% end %>

</div>

<script>
  const map = L.map('aurora-map', {
    zoomControl: false,
    dragging: false,
    scrollWheelZoom: false,
    doubleClickZoom: false,
    touchZoom: false
  }).setView([<%= @aurora.latitude %>, <%= @aurora.longitude %>], 12);

  L.tileLayer('https://api.mapbox.com/styles/v1/mapbox/dark-v11/tiles/256/{z}/{x}/{y}@2x?access_token=<%= ENV["MAPBOX_API_KEY"] %>', {
    attribution: 'Â© Mapbox Â© OpenStreetMap',
    maxZoom: 19
  }).addTo(map);

  setTimeout(() => { map.invalidateSize(); }, 100);

  const el = document.createElement('div');
  el.className = 'aurora-ping';
  L.marker([<%= @aurora.latitude %>, <%= @aurora.longitude %>], {
    icon: L.divIcon({ className: '', html: el.outerHTML, iconSize: [40, 40] })
  }).addTo(map);
</script>
