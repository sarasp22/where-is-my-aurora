<div class="page-container">

  <div class="page-header">
    <%= link_to root_path, class: "back-btn" do %>
      â† Back
    <% end %>
    <h1 class="page-title">ğŸ”­ Forecast</h1>
  </div>

  <% if @error %>
    <div class="error-card">
      <p>Unable to load forecast data. Please try again.</p>
    </div>
  <% else %>

    <div class="forecast-card">
      <div class="forecast-label">KP Index Now</div>
      <div class="kp-big <%= @kp_current >= 5 ? 'kp-high' : @kp_current >= 3 ? 'kp-medium' : 'kp-low' %>">
        <%= @kp_current %>
      </div>
      <div class="kp-advice">
        <% if @kp_current >= 5 %>
          <span class="advice-good">âœ… Aurora likely visible at mid latitudes!</span>
        <% elsif @kp_current >= 3 %>
          <span class="advice-medium">âš ï¸ Aurora possible at high latitudes</span>
        <% else %>
          <span class="advice-bad">âŒ Aurora unlikely â€” KP too low</span>
        <% end %>
      </div>
    </div>

    <div class="forecast-card">
      <div class="forecast-label">â˜ï¸ Cloud Cover</div>
      <div class="cloud-bar-container">
        <div class="cloud-bar" style="width: <%= @cloud_cover %>%"></div>
      </div>
      <div class="cloud-value"><%= @cloud_cover %>%</div>
    </div>

    <div class="forecast-card">
      <div class="forecast-label">ğŸ“ˆ KP History â€” Last 24h</div>
      <div class="kp-chart">
        <% @kp_history.each do |entry| %>
          <div class="kp-bar-wrap">
            <div class="kp-bar" style="height: <%= [(entry[:kp] / 9.0 * 100).round, 5].max %>%"
              title="<%= entry[:time] %>: KP <%= entry[:kp] %>">
            </div>
            <span class="kp-bar-val"><%= entry[:kp] %></span>
          </div>
        <% end %>
      </div>
    </div>

    <div class="forecast-card">
      <div class="forecast-label">ğŸ”® KP Forecast â€” Next 6 hours</div>
      <div class="kp-forecast-list">
        <% @kp_forecast.each do |entry| %>
          <div class="forecast-item">
            <span class="forecast-time"><%= Time.parse(entry[:time]).strftime("%H:%M") rescue entry[:time] %></span>
            <div class="forecast-bar-wrap">
              <div class="forecast-bar" style="width: <%= [(entry[:kp] / 9.0 * 100).round, 5].max %>%"></div>
            </div>
            <span class="forecast-kp <%= entry[:kp] >= 5 ? 'kp-high' : entry[:kp] >= 3 ? 'kp-medium' : 'kp-low' %>">
              <%= entry[:kp] %>
            </span>
          </div>
        <% end %>
      </div>
    </div>

  <% end %>

</div>
